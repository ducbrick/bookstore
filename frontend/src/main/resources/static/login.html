<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="description" content="Browse & discover millions of products. Read customer reviews and find best sellers. We ship to over 100 international destinations, right to your doorstep.">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <title>Book Store - Login</title>
    <link href="images/logo.png" rel="shortcut icon" />

    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
    <!-- Font Awesome -->
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />
    <!-- Custom style -->
    <link href="css/style.css" rel="stylesheet" />

    <!-- Application config -->
    <script src="js/config.js"></script>

    <!-- Optional JavaScript -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="/">Book Store</a>
        <a class="navbar-brand" href="/cart">Cart</a>
        <a class="navbar-brand" href="/book">Admin</a>
    </nav>

    <div class="container" id="main-content">
        <div class="row d-flex justify-content-center">
            <form style="min-width: 300px;" name="f" method="post">
                <h5 class="text-center">Login form</h5>
                <fieldset>
                    <div class="form-group">
                        <input class="form-control" type="text" id="username" name="username" placeholder="Username" />
                    </div>

                    <div class="form-group">
                        <input class="form-control" type="password" id="password" name="password" placeholder="Password" />
                        <em style="position: relative; top: 10px; color: red; display: none;" id="error-message">
                            Invalid username or password.
                        </em>
                    </div>

                    <div class="form-group" style="margin-top: 30px;">
                        <button type="submit" class="btn btn-block btn-primary">
                            <i class="fa fa-key"></i> Login
                        </button>
                    </div>
                </fieldset>
                <!-- CSRF token removed for static version -->
            </form>
        </div>
    </div>

    <footer class="container" style="padding: 50px;">
        <strong>&copy; <a href="https://github.com/crni99/" target="_blank">github/crni99</a></strong>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.querySelector('form[name="f"]');
        const errorMessage = document.getElementById('error-message');

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault(); // Prevent default form submission

            // Basic client-side validation
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                errorMessage.textContent = 'Please enter both username and password.';
                errorMessage.style.display = 'block';
                return;
            }

            // Send AJAX request
            try {
                const response = await fetch(window.APP_CONFIG.BACKEND_URL + '/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        username: username,
                        password: password
                    }),
                    credentials: 'include' // Include cookies for authentication
                });

                if (response.ok) {
                    // Success: Redirect or update UI
                    window.location.href = '/'; // Or handle as needed
                } else {
                    // Failure: Show error
                    errorMessage.textContent = 'Invalid username or password.';
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                errorMessage.textContent = 'Login failed. Please try again.';
                errorMessage.style.display = 'block';
            }
        });
    });
    </script>
</body>
</html>